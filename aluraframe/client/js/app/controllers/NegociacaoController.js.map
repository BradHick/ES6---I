{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","NegociacoesView","MensagemView","NegociacaoService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_ordemAtual","_service","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importaNegociacoes","textoParaData","value","parseInt","parseFloat","apaga","_esvazia","mensagem","event","preventDefault","_criaNegociacao","cadastra","_limpaFormulario","importa","focus","coluna","inverteOrdem","ordena","p","s"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\r\nimport {Mensagem} from '../models/Mensagem';\r\nimport {Negociacao} from '../models/Negociacao';\r\nimport {NegociacoesView} from '../views/NegociacoesView';\r\nimport {MensagemView} from '../views/MensagemView';\r\nimport {NegociacaoService} from '../services/NegociacaoService';\r\nimport {DateHelper} from '../helpers/DateHelper';\r\nimport {Bind} from '../helpers/Bind';\r\n\r\n\r\nexport class NegociacaoController {\r\n  constructor(){\r\n    let $ = document.querySelector.bind(document);\r\n    this._inputData = $('#data');\r\n    this._inputQuantidade = $('#quantidade');\r\n    this._inputValor = $('#valor');\r\n\r\n\r\n    this._listaNegociacoes = new Bind(\r\n                             new ListaNegociacoes(),\r\n                             new NegociacoesView($('#negociacoesView')),\r\n                             'adiciona', '_esvazia');\r\n\r\n    this._mensagem = new Bind(\r\n                     new Mensagem(), //noca Mensagem\r\n                     new MensagemView($('#mensagemView')), //nova instância de mensagemView\r\n                     'texto'); //parâmetros\r\n\r\n                     this._ordemAtual = '';\r\n\r\n                     this._service = new NegociacaoService();\r\n\r\n                     this._init();\r\n\r\n     }\r\n\r\n   _init() {\r\n\r\n       this._service\r\n           .lista()\r\n           .then(negociacoes =>\r\n               negociacoes.forEach(negociacao =>\r\n                   this._listaNegociacoes.adiciona(negociacao)))\r\n           .catch(erro => this._mensagem.texto = erro);\r\n\r\n      setInterval(() => {\r\n          this.importaNegociacoes();\r\n      }, 13000);\r\n\r\n     }\r\n\r\n  _criaNegociacao(){\r\n    return new Negociacao(\r\n      DateHelper.textoParaData(this._inputData.value),\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  apaga() {\r\n\r\n      this._service\r\n          .apaga()\r\n          .then(mensagem => {\r\n              this._listaNegociacoes._esvazia();\r\n              this._mensagem.texto = mensagem;\r\n          })\r\n          .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  adiciona(event) {\r\n\r\n      event.preventDefault();\r\n\r\n      let negociacao = this._criaNegociacao();\r\n\r\n      this._service\r\n          .cadastra(negociacao)\r\n          .then(mensagem => {\r\n              this._listaNegociacoes.adiciona(negociacao);\r\n              this._mensagem.texto = mensagem;\r\n              this._limpaFormulario();\r\n          })\r\n          .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  importaNegociacoes() {\r\n\r\n      this._service\r\n          .importa(this._listaNegociacoes.negociacoes)\r\n          .then(negociacoes => negociacoes.forEach(negociacao => {\r\n              this._listaNegociacoes.adiciona(negociacao);\r\n              this._mensagem.texto = 'Negociações do período importadas'\r\n          }))\r\n          .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n\r\n\r\n  _limpaFormulario(){\r\n  this._inputData.value = '';\r\n  this._inputValor.value = 0.0;\r\n  this._inputQuantidade.value = 1;\r\n\r\n  this._inputData.focus();\r\n\r\n  }\r\n\r\n  ordena(coluna) {\r\n\r\n      if(this._ordemAtual == coluna) {\r\n          this._listaNegociacoes.inverteOrdem();\r\n      } else {\r\n          this._listaNegociacoes.ordena((p, s) => p[coluna] - s[coluna]);\r\n      }\r\n      this._ordemAtual = coluna;\r\n  }\r\n\r\n\r\n\r\n}\r\n"]}